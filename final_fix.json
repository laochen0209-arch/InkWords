{
  "name": "InkWords_Final_Production_v4",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hours": 24
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [
        -220,
        0
      ],
      "id": "timer-news",
      "name": "â±ï¸ 24å°æ—¶ (News)"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hours": 48
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [
        -220,
        200
      ],
      "id": "timer-classics",
      "name": "â±ï¸ 48å°æ—¶ (Classics)"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hours": 72
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [
        -220,
        400
      ],
      "id": "timer-novels",
      "name": "â±ï¸ 72å°æ—¶ (Novels)"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "rss_url",
              "value": "http://feeds.bbci.co.uk/news/world/rss.xml"
            },
            {
              "name": "target_category",
              "value": "news"
            }
          ],
          "number": [
            {
              "name": "batch_limit",
              "value": 1
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        0,
        0
      ],
      "id": "config-news",
      "name": "é…ç½®: News (æµ‹è¯•)"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "rss_url",
              "value": "https://www.gutenberg.org/cache/epub/feeds/today.rss"
            },
            {
              "name": "target_category",
              "value": "classics"
            }
          ],
          "number": [
            {
              "name": "batch_limit",
              "value": 1
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        0,
        200
      ],
      "id": "config-classics",
      "name": "é…ç½®: Classics (æµ‹è¯•)"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "rss_url",
              "value": "https://standardebooks.org/feeds/rss/new-releases"
            },
            {
              "name": "target_category",
              "value": "novel"
            }
          ],
          "number": [
            {
              "name": "batch_limit",
              "value": 1
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        0,
        400
      ],
      "id": "config-novels",
      "name": "é…ç½®: Novels (æµ‹è¯•)"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        220,
        200
      ],
      "id": "config-hub",
      "name": "é…ç½®æ±‡æµ"
    },
    {
      "parameters": {
        "url": "={{ $json.rss_url }}"
      },
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1,
      "position": [
        440,
        200
      ],
      "id": "fetch-rss",
      "name": "æŠ“å– RSS"
    },
    {
      "parameters": {
        "jsCode": "const config = $('é…ç½®æ±‡æµ').first().json;\nconst limit = config.batch_limit || 1;\nconst category = config.target_category;\nconst newItems = items.slice(0, limit);\nnewItems.forEach(item => {\n  item.json.category = category;\n});\nreturn newItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        660,
        200
      ],
      "id": "limit-and-tag",
      "name": "âœ‚ï¸ è£å‰ªä¸æ‰“æ ‡"
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        880,
        200
      ],
      "id": "é€æ¡å¤„ç†",
      "name": "é€æ¡å¤„ç†"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.deepseek.com/chat/completions",
        "authentication": "none",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer YOUR_DEEPSEEK_KEY"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "deepseek-chat"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"role\": \"system\",\n    \"content\": \"ä½ æ˜¯ä¸€ä¸ªæå…¶ä¸¥è°¨çš„åŒè¯­ç¼–è¾‘ã€‚è¯·å¤„ç†ç”¨æˆ·è¾“å…¥çš„æ–‡ç« ç‰‡æ®µï¼Œå¹¶è¾“å‡ºä¸¥æ ¼çš„ JSON æ ¼å¼ã€‚\\n\\nä»»åŠ¡ï¼š\\n1. Title: ç”Ÿæˆè‹±æ–‡ä¸»æ ‡é¢˜ (title_en) å’Œä¸­æ–‡å‰¯æ ‡é¢˜ (title_zh)ã€‚\\n2. Summary: ç”Ÿæˆä¸€å¥è¯ä¸­æ–‡æ‘˜è¦ã€‚\\n3. Content: ä¿ç•™è‹±æ–‡æ­£æ–‡ (content_en) å¹¶ç”Ÿæˆä¸­æ–‡ç¿»è¯‘ (content_zh)ã€‚\\n4. Vocab: æå– 5-8 ä¸ªæ ¸å¿ƒç”Ÿè¯ (vocab_data)ï¼ŒåŒ…å« word, meaning, pronunciation, context_sentenceã€‚\\n\\nâš ï¸ æ³¨æ„ï¼šcategory å­—æ®µå·²ç”±ä¸Šæ¸¸é”å®šï¼Œæ— éœ€ç”Ÿæˆã€‚åªè¾“å‡ºçº¯ JSONï¼Œä¸è¦åŒ…å« ```json ä»£ç å—æ ‡è®°ã€‚\"\n  },\n  {\n    \"role\": \"user\",\n    \"content\": \"Title: \" + $json.title + \"\\nContent: \" + $json.contentSnippet\n  }\n] }}"
            },
            {
              "name": "response_format",
              "value": "={{ {\"type\": \"json_object\"} }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1100,
        200
      ],
      "id": "DeepSeek æ¸…æ´—",
      "name": "DeepSeek æ¸…æ´—"
    },
    {
      "parameters": {
        "jsCode": "// ğŸ§¹ æš´åŠ›æ¸…æ´—è§£æ (è§£å†³\"æ‰¾ä¸åˆ°å›è·¯\"æŠ¥é”™)\n// 1. è·å– DeepSeek çš„åŸå§‹å›ç­”\nconst raw = items[0].json.choices[0].message.content;\n\n// 2. æš´åŠ›å»é™¤éæ³•å­—ç¬¦\nconst clean = raw.replace(/```json/g, \"\").replace(/```/g, \"\").trim();\n\n// 3. è§£ææˆå¯¹è±¡\nlet data = {};\ntry {\n  data = JSON.parse(clean);\n} catch (e) {\n  data = { title_en: \"è§£æå¤±è´¥\", summary: \"JSON Error\" };\n}\n\n// 4. è·å–ä¸Šæ¸¸åˆ†ç±» (è¿™é‡Œæ˜¯å…³é”®ï¼æˆ‘ä»¬åœ¨è¿™é‡ŒæŠŠåˆ†ç±»æŠ“è¿‡æ¥ï¼Œæ‰“åŒ…ç»™ä¸‹æ¸¸)\nconst category = $('é€æ¡å¤„ç†').item.json.category;\n\n// 5. è¾“å‡ºçº¯å‡€æ•°æ®\nreturn [{\n  json: {\n    category: category,\n    title_en: data.title_en,\n    title_zh: data.title_zh,\n    summary: data.summary,\n    content_en: data.content_en,\n    content_zh: data.content_zh,\n    vocab_data: typeof data.vocab_data === 'object' ? JSON.stringify(data.vocab_data) : data.vocab_data\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1320,
        200
      ],
      "id": "code-parser",
      "name": "ğŸ“¦ æš´åŠ›æ¸…æ´—+æ‰“åŒ…"
    },
    {
      "parameters": {
        "tableId": "Article",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "title_en": "={{ $json.title_en }}",
            "title_zh": "={{ $json.title_zh }}",
            "content_en": "={{ $json.content_en }}",
            "content_zh": "={{ $json.content_zh }}",
            "vocab_data": "={{ $json.vocab_data }}",
            "summary": "={{ $json.summary }}",
            "category": "={{ $json.category }}"
          }
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1540,
        200
      ],
      "id": "supabase-insert",
      "name": "æ­£å¼å…¥åº“",
      "credentials": {
        "supabaseApi": {
          "id": "Supabase account", 
          "name": "Supabase account"
        }
      }
    }
  ],
  "connections": {
    "â±ï¸ 24å°æ—¶ (News)": {
      "main": [ [ { "node": "é…ç½®: News (æµ‹è¯•)", "type": "main", "index": 0 } ] ]
    },
    "â±ï¸ 48å°æ—¶ (Classics)": {
      "main": [ [ { "node": "é…ç½®: Classics (æµ‹è¯•)", "type": "main", "index": 0 } ] ]
    },
    "â±ï¸ 72å°æ—¶ (Novels)": {
      "main": [ [ { "node": "é…ç½®: Novels (æµ‹è¯•)", "type": "main", "index": 0 } ] ]
    },
    "é…ç½®: News (æµ‹è¯•)": {
      "main": [ [ { "node": "é…ç½®æ±‡æµ", "type": "main", "index": 0 } ] ]
    },
    "é…ç½®: Classics (æµ‹è¯•)": {
      "main": [ [ { "node": "é…ç½®æ±‡æµ", "type": "main", "index": 0 } ] ]
    },
    "é…ç½®: Novels (æµ‹è¯•)": {
      "main": [ [ { "node": "é…ç½®æ±‡æµ", "type": "main", "index": 0 } ] ]
    },
    "é…ç½®æ±‡æµ": {
      "main": [ [ { "node": "æŠ“å– RSS", "type": "main", "index": 0 } ] ]
    },
    "æŠ“å– RSS": {
      "main": [ [ { "node": "âœ‚ï¸ è£å‰ªä¸æ‰“æ ‡", "type": "main", "index": 0 } ] ]
    },
    "âœ‚ï¸ è£å‰ªä¸æ‰“æ ‡": {
      "main": [ [ { "node": "é€æ¡å¤„ç†", "type": "main", "index": 0 } ] ]
    },
    "é€æ¡å¤„ç†": {
      "main": [ [ { "node": "DeepSeek æ¸…æ´—", "type": "main", "index": 0 } ] ]
    },
    "DeepSeek æ¸…æ´—": {
      "main": [ [ { "node": "ğŸ“¦ æš´åŠ›æ¸…æ´—+æ‰“åŒ…", "type": "main", "index": 0 } ] ]
    },
    "ğŸ“¦ æš´åŠ›æ¸…æ´—+æ‰“åŒ…": {
      "main": [ [ { "node": "æ­£å¼å…¥åº“", "type": "main", "index": 0 } ] ]
    },
    "æ­£å¼å…¥åº“": {
      "main": [ [ { "node": "é€æ¡å¤„ç†", "type": "main", "index": 0 } ] ]
    }
  }
}