# 墨语模拟考试系统 - 完整实施方案

## 🎯 项目目标
创建全新的 N8N 工作流生成学习内容，并开发付费模拟考试系统，覆盖英语/中文四六级、八级及日常应用考试。

---

## 📊 系统架构设计

### 整体架构
```
N8N 工作流群
├── 学习内容生成工作流
├── 英语考试生成工作流
├── 中文考试生成工作流
└── 日常应用考试生成工作流
         ↓
PostgreSQL 数据库
         ↓
Next.js API 层
         ↓
前端页面（Study + Quiz）
```

---

## 🔧 第一阶段：N8N 工作流开发

### 工作流 1：学习内容生成工作流

**功能**：为 `/study` 页面生成日常学习词汇和句子

**工作流设计**：
```
定时触发（每天 02:00）
  ↓
AI 内容生成节点（DeepSeek）
  - 生成 20 个高频词汇（中英双语）
  - 生成 10 个实用句子（中英双语）
  - 添加拼音标注
  - 生成例句
  ↓
数据格式化节点
  - JSON 结构化
  - 添加难度评级（1-5）
  - 添加分类标签
  ↓
去重检查节点
  - 检查数据库是否已存在
  - 过滤重复内容
  ↓
批量入库节点
  - 插入 Vocabulary 表
  - 插入 Sentence 表
  ↓
完成通知节点
```

**AI 提示词模板**：
```
请生成 20 个中英双语词汇，要求：
1. 词汇类型：日常高频词
2. 难度等级：1-3 级（初级到中级）
3. 每个词汇包含：
   - 英文单词
   - 中文含义
   - 拼音（中文）
   - 英文例句
   - 中文例句翻译
4. 输出格式：纯 JSON 数组

请生成 10 个中英双语句子，要求：
1. 句子类型：日常实用句
2. 难度等级：1-3 级
3. 每个句子包含：
   - 英文句子
   - 中文翻译
   - 拼音（中文）
   - 场景标签（如：问候、购物、旅行等）
4. 输出格式：纯 JSON 数组
```

---

### 工作流 2：英语考试生成工作流

**功能**：生成英语四六级、八级模拟考试题目

**工作流设计**：
```
手动触发 / 定时触发（每周一 00:00）
  ↓
考试类型选择节点
  - 英语四级（CET-4）
  - 英语六级（CET-6）
  - 英语八级（TEM-8）
  ↓
AI 题目生成节点（DeepSeek）
  - 生成完整试卷（听力、阅读、写作、翻译）
  - 每种题型 10-20 题
  - 包含正确答案和解析
  ↓
题目分类节点
  - 听力题
  - 阅读理解
  - 完形填空
  - 翻译题
  - 写作题
  ↓
数据验证节点
  - 验证题目质量
  - 验证答案准确性
  ↓
批量入库节点
  - 插入 QuizQuestion 表
  - 插入 QuizSet 表（试卷集合）
  ↓
完成通知节点
```

**AI 提示词模板（以 CET-4 为例）**：
```
请生成一套完整的英语四级（CET-4）模拟考试题目，要求：

1. 听力部分（30分）：
   - 10 道短对话选择题
   - 10 道长对话选择题
   - 10 道短文理解选择题
   - 每题包含：音频文本、问题、4个选项、正确答案、解析

2. 阅读理解部分（40分）：
   - 4 篇阅读文章
   - 每篇 5 道选择题
   - 每题包含：文章内容、问题、4个选项、正确答案、解析

3. 完形填空部分（10分）：
   - 1 篇文章，20 个空
   - 每空 4 个选项
   - 包含正确答案和解析

4. 翻译部分（10分）：
   - 1 道汉译英
   - 1 道英译汉
   - 包含参考译文和评分要点

5. 写作部分（10分）：
   - 1 道作文题
   - 包含题目要求、参考范文、评分标准

输出格式：纯 JSON，结构化所有题目
```

---

### 工作流 3：中文考试生成工作流

**功能**：生成中文四六级、八级模拟考试题目

**工作流设计**：
```
手动触发 / 定时触发（每周三 00:00）
  ↓
考试类型选择节点
  - 中文四级（HSK-4）
  - 中文六级（HSK-6）
  - 中文八级（HSK-8）
  ↓
AI 题目生成节点（DeepSeek）
  - 生成完整试卷（听力、阅读、书写）
  - 每种题型 10-20 题
  - 包含正确答案和解析
  ↓
题目分类节点
  - 听力题
  - 阅读理解
  - 书写题（汉字、作文）
  ↓
数据验证节点
  ↓
批量入库节点
  ↓
完成通知节点
```

**AI 提示词模板（以 HSK-4 为例）**：
```
请生成一套完整的中文四级（HSK-4）模拟考试题目，要求：

1. 听力部分（40分）：
   - 10 道短对话选择题
   - 10 道长对话选择题
   - 10 道短文理解选择题
   - 每题包含：音频文本、问题、4个选项、正确答案、解析

2. 阅读理解部分（40分）：
   - 3 篇阅读文章
   - 每篇 5-10 道选择题
   - 每题包含：文章内容、问题、4个选项、正确答案、解析

3. 书写部分（20分）：
   - 10 道汉字书写题（根据拼音写汉字）
   - 1 道作文题（100-150字）
   - 包含参考答案和评分标准

输出格式：纯 JSON，结构化所有题目
```

---

### 工作流 4：日常应用考试生成工作流

**功能**：生成日常应用场景考试题目

**工作流设计**：
```
手动触发 / 定时触发（每周五 00:00）
  ↓
场景选择节点
  - 日常对话
  - 职场沟通
  - 旅行交流
  - 购物场景
  - 餐厅点餐
  - 医疗健康
  ↓
AI 题目生成节点（DeepSeek）
  - 生成场景化题目
  - 包含对话题、选择题、填空题
  - 每个场景 10-15 题
  ↓
场景标签节点
  - 添加场景分类
  - 添加难度评级
  ↓
批量入库节点
  ↓
完成通知节点
```

**AI 提示词模板**：
```
请生成一套"日常对话"场景的考试题目，要求：

1. 对话理解题（10道）：
   - 模拟真实对话场景
   - 根据对话内容回答问题
   - 包含中英文双语

2. 词汇应用题（10道）：
   - 选择正确的词汇填空
   - 考查日常词汇运用
   - 包含中英文双语

3. 情景反应题（10道）：
   - 给定情景，选择合适的回应
   - 考查语用能力
   - 包含中英文双语

4. 翻译题（5道）：
   - 中英互译
   - 日常用语

输出格式：纯 JSON，结构化所有题目
```

---

## 🗄️ 第二阶段：数据库设计

### 新增表结构

#### 1. QuizSet（试卷集合表）
```sql
CREATE TABLE "QuizSet" (
  "id" TEXT PRIMARY KEY,
  "title" TEXT NOT NULL,
  "description" TEXT,
  "type" TEXT NOT NULL, -- 'cet4', 'cet6', 'tem8', 'hsk4', 'hsk6', 'hsk8', 'daily'
  "category" TEXT NOT NULL, -- 'english', 'chinese', 'daily'
  "difficulty" INTEGER NOT NULL, -- 1-5
  "duration" INTEGER NOT NULL, -- 考试时长（分钟）
  "totalScore" INTEGER NOT NULL, -- 总分
  "questionCount" INTEGER NOT NULL, -- 题目数量
  "isPremium" BOOLEAN NOT NULL DEFAULT true, -- 是否付费
  "price" INTEGER, -- 价格（积分或金额）
  "tags" TEXT[], -- 标签
  "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "updatedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX "QuizSet_type_idx" ON "QuizSet"("type");
CREATE INDEX "QuizSet_category_idx" ON "QuizSet"("category");
```

#### 2. QuizQuestion（考试题目表）
```sql
CREATE TABLE "QuizQuestion" (
  "id" TEXT PRIMARY KEY,
  "quizSetId" TEXT NOT NULL,
  "type" TEXT NOT NULL, -- 'listening', 'reading', 'cloze', 'translation', 'writing', 'dialogue', 'vocabulary'
  "question" TEXT NOT NULL,
  "options" JSONB, -- 选项数组
  "correctAnswer" TEXT NOT NULL,
  "explanation" TEXT,
  "audioText" TEXT, -- 听力文本
  "difficulty" INTEGER, -- 1-5
  "order" INTEGER NOT NULL, -- 题目顺序
  "score" INTEGER NOT NULL DEFAULT 1, -- 分值
  "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "updatedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX "QuizQuestion_quizSetId_idx" ON "QuizQuestion"("quizSetId");
CREATE INDEX "QuizQuestion_type_idx" ON "QuizQuestion"("type");
```

#### 3. QuizResult（考试结果表）
```sql
CREATE TABLE "QuizResult" (
  "id" TEXT PRIMARY KEY,
  "userId" TEXT NOT NULL,
  "quizSetId" TEXT NOT NULL,
  "score" INTEGER NOT NULL,
  "totalScore" INTEGER NOT NULL,
  "correctCount" INTEGER NOT NULL,
  "totalCount" INTEGER NOT NULL,
  "duration" INTEGER NOT NULL, -- 实际用时（秒）
  "answers" JSONB, -- 用户答案
  "wrongQuestions" TEXT[], -- 错题ID数组
  "completedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX "QuizResult_userId_idx" ON "QuizResult"("userId");
CREATE INDEX "QuizResult_quizSetId_idx" ON "QuizResult"("quizSetId");
```

#### 4. UserSubscription（用户订阅表）
```sql
CREATE TABLE "UserSubscription" (
  "id" TEXT PRIMARY KEY,
  "userId" TEXT NOT NULL,
  "type" TEXT NOT NULL, -- 'monthly', 'yearly', 'lifetime'
  "status" TEXT NOT NULL, -- 'active', 'expired', 'cancelled'
  "startDate" TIMESTAMP(3) NOT NULL,
  "endDate" TIMESTAMP(3) NOT NULL,
  "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "updatedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX "UserSubscription_userId_idx" ON "UserSubscription"("userId");
CREATE INDEX "UserSubscription_status_idx" ON "UserSubscription"("status");
```

#### 5. 扩展现有表

**Vocabulary 表扩展**：
```sql
ALTER TABLE "Vocabulary" ADD COLUMN "source" TEXT;
ALTER TABLE "Vocabulary" ADD COLUMN "tags" TEXT[];
ALTER TABLE "Vocabulary" ADD COLUMN "frequency" INTEGER DEFAULT 0;
```

**Sentence 表扩展**：
```sql
ALTER TABLE "Sentence" ADD COLUMN "source" TEXT;
ALTER TABLE "Sentence" ADD COLUMN "tags" TEXT[];
ALTER TABLE "Sentence" ADD COLUMN "category" TEXT;
```

---

## 🔌 第三阶段：API 开发

### 1. 学习内容 API

#### GET /api/study/data
```typescript
// 获取学习内容
Response: {
  words: Vocabulary[],
  sentences: Sentence[],
  totalCount: number
}
```

#### POST /api/study/progress
```typescript
// 记录学习进度
Request: {
  wordId: string,
  isCorrect: boolean,
  timeSpent: number
}
```

---

### 2. 考试系统 API

#### GET /api/quiz/sets
```typescript
// 获取试卷列表
Query: {
  type?: 'cet4' | 'cet6' | 'tem8' | 'hsk4' | 'hsk6' | 'hsk8' | 'daily',
  category?: 'english' | 'chinese' | 'daily',
  isPremium?: boolean
}

Response: {
  sets: QuizSet[],
  totalCount: number
}
```

#### GET /api/quiz/:setId
```typescript
// 获取试卷详情
Response: {
  quizSet: QuizSet,
  questions: QuizQuestion[],
  canAccess: boolean
}
```

#### POST /api/quiz/start
```typescript
// 开始考试
Request: {
  quizSetId: string
}

Response: {
  sessionId: string,
  questions: QuizQuestion[],
  startTime: string
}
```

#### POST /api/quiz/submit
```typescript
// 提交答案
Request: {
  sessionId: string,
  answers: { questionId: string, answer: string }[]
}

Response: {
  result: QuizResult,
  score: number,
  correctCount: number,
  wrongQuestions: QuizQuestion[],
  analysis: string
}
```

#### GET /api/quiz/history
```typescript
// 获取考试历史
Query: {
  userId: string,
  type?: string,
  limit?: number
}

Response: {
  results: QuizResult[],
  statistics: {
    totalQuizzes: number,
    averageScore: number,
    bestScore: number,
    recentTrend: number[]
  }
}
```

---

### 3. 订阅系统 API

#### GET /api/subscription/status
```typescript
// 获取用户订阅状态
Response: {
  isSubscribed: boolean,
  type: string | null,
  endDate: string | null,
  remainingDays: number
}
```

#### POST /api/subscription/purchase
```typescript
// 购买订阅
Request: {
  type: 'monthly' | 'yearly' | 'lifetime'
}

Response: {
  success: boolean,
  subscription: UserSubscription,
  paymentUrl?: string
}
```

---

## 🎨 第四阶段：前端页面开发

### 1. 更新 Study 页面（/study）

**功能优化**：
- 集成新的学习内容 API
- 添加难度选择器（1-5级）
- 添加分类筛选（词汇/句子）
- 优化学习进度显示
- 添加收藏功能
- 添加学习统计

**UI 设计**：
```
┌─────────────────────────────────┐
│  ← 返回    学习中心    设置     │
├─────────────────────────────────┤
│  📊 学习进度                    │
│  ████████░░░░░░░ 80%          │
│  已学习 80/100 个词汇           │
├─────────────────────────────────┤
│  🔍 筛选                        │
│  [词汇] [句子] [全部]          │
│  难度：[1] [2] [3] [4] [5]    │
├─────────────────────────────────┤
│  📚 今日学习内容                │
│  ┌─────────────────────────┐   │
│  │ 单词卡片                │   │
│  │ Serendipity            │   │
│  │ 不期而遇的美好          │   │
│  │ [播放] [收藏] [下一题]  │   │
│  └─────────────────────────┘   │
├─────────────────────────────────┤
│  🎯 快速测试                    │
│  [开始模拟考试]                 │
└─────────────────────────────────┘
```

---

### 2. 创建 Quiz 页面（/quiz）

#### 2.1 试卷列表页（/quiz）

**功能**：
- 显示所有可用试卷
- 分类筛选（英语/中文/日常）
- 难度筛选
- 显示试卷信息（时长、题数、价格）
- 付费标识

**UI 设计**：
```
┌─────────────────────────────────┐
│  ← 返回    模拟考试中心        │
├─────────────────────────────────┤
│  🔍 筛选                        │
│  [英语] [中文] [日常]          │
│  [四级] [六级] [八级]          │
├─────────────────────────────────┤
│  📚 试卷列表                    │
│  ┌─────────────────────────┐   │
│  │ 🎓 英语四级模拟考试      │   │
│  │ 时长：120分钟 | 题数：80  │   │
│  │ 难度：⭐⭐⭐            │   │
│  │ 💰 99积分 | [开始考试]    │   │
│  └─────────────────────────┘   │
│  ┌─────────────────────────┐   │
│  │ 🎓 英语六级模拟考试      │   │
│  │ 时长：130分钟 | 题数：85  │   │
│  │ 难度：⭐⭐⭐⭐          │   │
│  │ 💰 149积分 | [开始考试]    │   │
│  └─────────────────────────┘   │
└─────────────────────────────────┘
```

---

#### 2.2 考试进行页（/quiz/[id]/take）

**功能**：
- 倒计时显示
- 题目导航（题号列表）
- 题目展示
- 答案选择
- 标记功能（标记不确定的题目）
- 上一题/下一题
- 提交考试

**UI 设计**：
```
┌─────────────────────────────────┐
│  ← 退出    英语四级模拟考试    │
│  ⏱️ 01:59:30                  │
├─────────────────────────────────┤
│  题目导航                      │
│  [1✓] [2✓] [3?] [4] [5] ...  │
├─────────────────────────────────┤
│  第 3/80 题                    │
│  听力理解                      │
├─────────────────────────────────┤
│  🎧 播放音频                   │
│  [播放] [暂停]                 │
├─────────────────────────────────┤
│  问题：                        │
│  What does the woman mean?      │
│  A. She wants to go home.      │
│  B. She wants to stay.         │
│  C. She is tired.              │
│  D. She is hungry.             │
│                                 │
│  [ ] A  [ ] B  [ ] C  [ ] D   │
│  [标记此题]                    │
├─────────────────────────────────┤
│  [上一题] [下一题] [提交考试]   │
└─────────────────────────────────┘
```

---

#### 2.3 考试结果页（/quiz/[id]/result）

**功能**：
- 显示总分
- 显示正确率
- 错题回顾
- 详细解析
- 学习建议
- 再考一次
- 查看历史

**UI 设计**：
```
┌─────────────────────────────────┐
│  ← 返回    考试结果            │
├─────────────────────────────────┤
│  🎉 恭喜完成考试！              │
│                                 │
│  总分：85/100                   │
│  正确率：85%                    │
│  用时：01:45:30                 │
│                                 │
│  📊 成绩分布                    │
│  听力：28/30 ⭐⭐⭐⭐⭐        │
│  阅读：32/40 ⭐⭐⭐⭐          │
│  完形：8/10 ⭐⭐⭐⭐⭐         │
│  翻译：8/10 ⭐⭐⭐⭐           │
│  写作：9/10 ⭐⭐⭐⭐⭐         │
├─────────────────────────────────┤
│  ❌ 错题回顾（12题）            │
│  ┌─────────────────────────┐   │
│  │ 第 5 题 - 听力理解      │   │
│  │ 你的答案：B              │   │
│  │ 正确答案：A              │   │
│  │ 解析：...               │   │
│  └─────────────────────────┘   │
├─────────────────────────────────┤
│  💡 学习建议                    │
│  - 加强听力训练                 │
│  - 多做阅读理解                 │
│  - 背诵高频词汇                 │
├─────────────────────────────────┤
│  [查看详细解析] [再考一次]      │
└─────────────────────────────────┘
```

---

### 3. 创建订阅页面（/subscription）

**功能**：
- 显示订阅套餐
- 套餐对比
- 购买流程
- 会员权益说明

**UI 设计**：
```
┌─────────────────────────────────┐
│  ← 返回    会员订阅            │
├─────────────────────────────────┤
│  💎 解锁全部考试功能            │
│                                 │
│  📦 套餐选择                    │
│  ┌─────────┬─────────┬─────────┐│
│  │ 月度会员 │ 年度会员 │ 终身会员 ││
│  │  99积分  │  999积分 │ 1999积分 ││
│  │  [购买]  │  [购买]  │  [购买]  ││
│  └─────────┴─────────┴─────────┘│
│                                 │
│  ✨ 会员权益                    │
│  ✓ 无限次参加所有考试            │
│  ✓ 查看详细解析                 │
│  ✓ 错题本功能                   │
│  ✓ 学习数据分析                 │
│  ✓ 优先更新                     │
│  ✓ 专属客服                     │
└─────────────────────────────────┘
```

---

## 🎯 第五阶段：用户体验优化

### 1. 统一 Web 风格

**设计规范**：
- 主色调：#C23E32（朱红色）
- 辅助色：#FDFBF7（米白色背景）
- 字体：思源宋体（标题）+ 思源黑体（正文）
- 圆角：12px
- 阴影：0 4px 20px rgba(43,43,43,0.08)
- 间距：8px 基准单位

**组件库统一**：
- 使用现有的 Radix UI 组件
- 统一按钮样式
- 统一卡片样式
- 统一表单样式

---

### 2. 交互优化

**加载状态**：
- 骨架屏加载
- 进度指示器
- 优雅降级

**反馈机制**：
- Toast 提示
- 确认对话框
- 错误提示

**动画效果**：
- 页面切换动画
- 按钮点击反馈
- 进度条动画

---

### 3. 响应式设计

**断点**：
- Mobile: < 640px
- Tablet: 640px - 1024px
- Desktop: > 1024px

**适配策略**：
- 移动优先
- 触摸友好
- 横屏支持

---

## 📊 第六阶段：数据分析与优化

### 1. 学习数据统计

**指标**：
- 每日学习时长
- 词汇掌握率
- 句子掌握率
- 学习连续天数
- 考试成绩趋势

**可视化**：
- 学习曲线图
- 成绩雷达图
- 进度环形图
- 历史趋势图

---

### 2. 考试数据分析

**指标**：
- 各题型正确率
- 薄弱知识点
- 常见错误类型
- 用时分布

**智能推荐**：
- 根据错误率推荐练习
- 根据薄弱点推荐学习内容
- 根据进步情况调整难度

---

## 🚀 实施计划

### 第一周：N8N 工作流开发
- Day 1-2: 学习内容生成工作流
- Day 3-4: 英语考试生成工作流
- Day 5-6: 中文考试生成工作流
- Day 7: 日常应用考试生成工作流

### 第二周：数据库与 API 开发
- Day 1-2: 数据库表设计与迁移
- Day 3-4: 学习内容 API 开发
- Day 5-6: 考试系统 API 开发
- Day 7: 订阅系统 API 开发

### 第三周：前端页面开发
- Day 1-2: 更新 Study 页面
- Day 3-4: 创建 Quiz 列表页
- Day 5-6: 创建考试进行页
- Day 7: 创建考试结果页

### 第四周：优化与测试
- Day 1-2: 创建订阅页面
- Day 3-4: UI 统一与优化
- Day 5-6: 功能测试与修复
- Day 7: 性能优化与上线

---

## 📈 预期成果

### 内容丰富度
- ✅ 每天新增 20 个词汇
- ✅ 每天新增 10 个句子
- ✅ 每周新增 4 套完整试卷
- ✅ 覆盖 7 种考试类型

### 用户体验
- ✅ 流畅的学习体验
- ✅ 专业的考试界面
- ✅ 详细的成绩分析
- ✅ 个性化学习建议

### 商业价值
- ✅ 付费订阅模式
- ✅ 多样化套餐选择
- ✅ 持续的内容更新
- ✅ 用户粘性提升

---

## 🔐 安全与隐私

### 数据安全
- 用户数据加密存储
- API 访问权限控制
- 防止作弊机制
- 数据备份策略

### 隐私保护
- 遵循 GDPR 标准
- 用户数据匿名化
- 明确的隐私政策
- 用户数据删除权